<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N2B ì •ë¶€ì§€ì›ì‚¬ì—… ë§¤ì¹­ v3.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-2xl font-bold">ğŸš€ N2B ì •ë¶€ì§€ì›ì‚¬ì—… ë§¤ì¹­</h1>
            <p class="text-purple-100 mt-1">v3.1 - ì§€ì—­ í•„í„°ë§ ì§€ì›</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- API Key -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ”‘ Anthropic API Key</label>
            <input type="password" id="apiKey" class="w-full px-4 py-3 border rounded-lg" placeholder="sk-ant-api...">
            <p class="text-xs text-gray-500 mt-1">API í‚¤ëŠ” <a href="https://console.anthropic.com" target="_blank" class="text-purple-600 underline">Anthropic Console</a>ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <!-- Region -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ ì§€ì—­ ì„ íƒ</label>
            <select id="regionSelect" class="w-full px-4 py-3 border rounded-lg bg-white">
                <option value="ì „ì²´">ğŸ‡°ğŸ‡· ì „ì²´ (ì „êµ­)</option>
                <option value="ì„œìš¸">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                <option value="ë¶€ì‚°">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                <option value="ëŒ€êµ¬">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                <option value="ì¸ì²œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                <option value="ê´‘ì£¼">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                <option value="ëŒ€ì „">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                <option value="ìš¸ì‚°">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                <option value="ì„¸ì¢…">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                <option value="ê²½ê¸°">ê²½ê¸°ë„</option>
                <option value="ê°•ì›">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
                <option value="ì¶©ë¶">ì¶©ì²­ë¶ë„</option>
                <option value="ì¶©ë‚¨">ì¶©ì²­ë‚¨ë„</option>
                <option value="ì „ë¶">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
                <option value="ì „ë‚¨">ì „ë¼ë‚¨ë„</option>
                <option value="ê²½ë¶">ê²½ìƒë¶ë„</option>
                <option value="ê²½ë‚¨">ê²½ìƒë‚¨ë„</option>
                <option value="ì œì£¼">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
            </select>
        </div>

        <!-- ì‚¬ì—…ê³„íš ì…ë ¥ -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ ì‚¬ì—…ê³„íš ì…ë ¥</label>
            <p class="text-xs text-gray-500 mb-2">ìƒ˜í”Œì„ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”:</p>
            <div class="flex flex-wrap gap-2 mb-3">
                <button onclick="loadSample('health')" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm">ğŸ¥ AI í—¬ìŠ¤ì¼€ì–´</button>
                <button onclick="loadSample('farm')" class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm">ğŸŒ± ìŠ¤ë§ˆíŠ¸íŒœ</button>
                <button onclick="loadSample('recycle')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">â™»ï¸ íí”Œë¼ìŠ¤í‹± ì¬í™œìš©</button>
            </div>
            <textarea id="proposalText" rows="5" class="w-full px-4 py-3 border rounded-lg" placeholder="ì‚¬ì—… ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="flex gap-4 mb-6">
            <button onclick="analyzeN2B()" class="flex-1 gradient-bg text-white py-4 rounded-xl font-bold">1ï¸âƒ£ N2B ë¶„ì„</button>
            <button onclick="matchPrograms()" id="matchBtn" disabled class="flex-1 bg-gray-400 text-white py-4 rounded-xl font-bold disabled:opacity-50">2ï¸âƒ£ ì§€ì›ì‚¬ì—… ë§¤ì¹­</button>
        </div>

        <!-- ë¡œë”© -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
            <p class="mt-4 text-gray-600">ë¶„ì„ ì¤‘...</p>
        </div>

        <!-- N2B ê²°ê³¼ -->
        <div id="n2bResult" class="hidden bg-white rounded-xl shadow-md p-4 mb-4">
            <h2 class="text-lg font-bold text-gray-800 mb-4">ğŸ“Š N2B ë¶„ì„ ê²°ê³¼</h2>
            <div class="space-y-3">
                <div class="bg-red-50 border-l-4 border-red-500 p-3 rounded">
                    <h3 class="font-bold text-red-700 text-sm">N (Not) - ë¬¸ì œì </h3>
                    <p id="resultN" class="text-gray-700 text-sm mt-1"></p>
                </div>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded">
                    <h3 class="font-bold text-blue-700 text-sm">B (But) - ì†”ë£¨ì…˜</h3>
                    <p id="resultB" class="text-gray-700 text-sm mt-1"></p>
                </div>
                <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                    <h3 class="font-bold text-green-700 text-sm">C (Because) - ê·¼ê±°</h3>
                    <p id="resultC" class="text-gray-700 text-sm mt-1"></p>
                </div>
                <div class="bg-purple-50 p-3 rounded">
                    <h3 class="font-bold text-purple-700 text-sm">ğŸ·ï¸ í‚¤ì›Œë“œ</h3>
                    <div id="resultKeywords" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
            </div>
        </div>

        <!-- ë§¤ì¹­ ê²°ê³¼ -->
        <div id="matchResult" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-800">ğŸ¯ ë§¤ì¹­ëœ ì§€ì›ì‚¬ì—…</h2>
                <span id="regionBadge" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm"></span>
            </div>
            <div id="programList" class="space-y-4"></div>
        </div>
    </main>

    <script>
        let n2bAnalysis = null;
        const API_BASE = 'https://n2b-backend.onrender.com';

        const samples = {
            health: 'ì €ëŠ” IoT ì„¼ì„œì™€ AIë¥¼ ê²°í•©í•˜ì—¬ í† ì–‘, ê¸°í›„, ì‘ë¬¼ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìµœì ì˜ ì¬ë°° í™˜ê²½ì„ ìë™ ì œì–´í•˜ëŠ” ìŠ¤ë§ˆíŠ¸íŒœ ì†”ë£¨ì…˜ì„ ê°œë°œí•©ë‹ˆë‹¤.',
            farm: 'ì €ëŠ” IoT ì„¼ì„œì™€ AIë¥¼ ê²°í•©í•˜ì—¬ í† ì–‘, ê¸°í›„, ì‘ë¬¼ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìµœì ì˜ ì¬ë°° í™˜ê²½ì„ ìë™ ì œì–´í•˜ëŠ” ìŠ¤ë§ˆíŠ¸íŒœ ì†”ë£¨ì…˜ì„ ê°œë°œí•©ë‹ˆë‹¤.',
            recycle: 'AI ê¸°ë°˜ íí”Œë¼ìŠ¤í‹± ìë™ ë¶„ë¥˜ ì‹œìŠ¤í…œì„ ê°œë°œí•˜ì—¬ ì¬í™œìš©ë¥ ì„ ë†’ì´ê³  í™˜ê²½ì˜¤ì—¼ì„ ì¤„ì´ëŠ” ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.'
        };

        function loadSample(key) {
            document.getElementById('proposalText').value = samples[key] || '';
        }

        async function analyzeN2B() {
            const apiKey = document.getElementById('apiKey').value;
            const proposalText = document.getElementById('proposalText').value;

            if (!apiKey) { alert('API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            if (!proposalText) { alert('ì‚¬ì—…ê³„íšì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            showLoading(true);

            try {
                const response = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, proposalText })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'ë¶„ì„ ì‹¤íŒ¨');
                }

                n2bAnalysis = data;

                document.getElementById('resultN').textContent = data.N || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ';
                document.getElementById('resultB').textContent = data.B || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ';
                document.getElementById('resultC').textContent = data.C || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ';

                const keywordsDiv = document.getElementById('resultKeywords');
                const keywords = data.keywords || [];
                if (keywords.length > 0) {
                    keywordsDiv.innerHTML = keywords.map(k => 
                        `<span class="px-3 py-1 bg-purple-200 text-purple-800 rounded-full text-sm">${k}</span>`
                    ).join('');
                } else {
                    keywordsDiv.innerHTML = '<span class="text-gray-500 text-sm">í‚¤ì›Œë“œ ì—†ìŒ</span>';
                }

                document.getElementById('n2bResult').classList.remove('hidden');
                document.getElementById('matchBtn').disabled = false;
                document.getElementById('matchBtn').classList.remove('bg-gray-400');
                document.getElementById('matchBtn').classList.add('bg-green-500');

            } catch (error) {
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function matchPrograms() {
            const apiKey = document.getElementById('apiKey').value;
            const region = document.getElementById('regionSelect').value;

            if (!n2bAnalysis) { alert('ë¨¼ì € N2B ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”.'); return; }

            showLoading(true);

            try {
                const response = await fetch(`${API_BASE}/match`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, n2bAnalysis, region })
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.detail || 'ë§¤ì¹­ ì‹¤íŒ¨');
                }

                document.getElementById('regionBadge').textContent = `ğŸ“ ${region === 'ì „ì²´' ? 'ì „êµ­' : region}`;

                const listDiv = document.getElementById('programList');
                const programs = data.programs || [];
                
                if (programs.length > 0) {
                    listDiv.innerHTML = programs.map(p => `
                        <div class="bg-white rounded-xl shadow-md p-4 card-hover transition">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">${p.region || region}</span>
                                <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">ë§¤ì¹­ ${p.matchScore || 85}%</span>
                            </div>
                            <h3 class="font-bold text-gray-800">${p.name || 'ì‚¬ì—…ëª… ì—†ìŒ'}</h3>
                            <p class="text-gray-600 text-sm">ğŸ¢ ${p.organization || '-'}</p>
                            <p class="text-gray-600 text-sm">ğŸ“… ë§ˆê°: ${p.deadline || '-'}</p>
                            <p class="text-gray-600 text-sm">ğŸ’° ${p.amount || '-'}</p>
                            <p class="text-purple-600 text-sm mt-2">ğŸ’¡ ${p.matchReason || ''}</p>
                            ${p.url ? `<a href="${p.url}" target="_blank" class="inline-block mt-2 px-4 py-2 bg-purple-500 text-white rounded-lg text-sm">ìƒì„¸ë³´ê¸° â†’</a>` : ''}
                        </div>
                    `).join('');
                } else {
                    listDiv.innerHTML = `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-center">
                            <p class="text-yellow-700">ğŸ˜… ë§¤ì¹­ëœ ì§€ì›ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p class="text-gray-600 text-sm mt-2">ë‹¤ë¥¸ ì§€ì—­ì´ë‚˜ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</p>
                            ${data.raw ? `<p class="text-xs text-gray-400 mt-2">Raw: ${data.raw.substring(0, 200)}...</p>` : ''}
                        </div>
                    `;
                }

                document.getElementById('matchResult').classList.remove('hidden');

            } catch (error) {
                alert('ë§¤ì¹­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }
    </script>
</body>
</html>
